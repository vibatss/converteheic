async function converter() {
  const formatoSelecionado = document.getElementById("formato").value;
  carregando.style.display = "block";
  preview.innerHTML = "";

  for (let file of arquivosSelecionados) {
    try {
      const result = await heic2any({
        blob: file,
        toType: formatoSelecionado,
        quality: 0.9
      });

      const extensao = formatoSelecionado.split("/")[1]; // pega jpg, png ou webp
      const url = URL.createObjectURL(result);
      const link = document.createElement("a");
      link.href = url;
      link.download = file.name.replace(/\.heic$/i, `.${extensao}`);
      link.textContent = `⬇️ Baixar ${link.download}`;
      link.className = "btn";
      link.style.display = "block";
      link.style.margin = "10px auto";

      preview.appendChild(link);
    } catch (e) {
      const error = document.createElement("p");
      error.textContent = `Erro ao converter ${file.name}`;
      preview.appendChild(error);
    }
  }

  carregando.style.display = "none";
}
